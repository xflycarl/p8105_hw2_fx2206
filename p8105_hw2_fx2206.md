p8105_hw2_fx2206
================
Fei Xue
2025-09-30

``` r
library(tidyverse)
library(readxl)
library(janitor)
options(tibble.print_min = 5)
```

# Problem 1

## 1.1

``` r
pols_month <- 
  read_csv("./fivethirtyeight_datasets/pols-month.csv", show_col_types = FALSE) |> 
  janitor::clean_names() |>
  separate(mon, into = c("year", "month", "day"), sep = "-") |>
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day),
    month = month.abb[month],
    president = case_when(
      prez_gop == 1 ~ "gop",
      prez_dem == 1 ~ "dem",
      TRUE ~ NA_character_
    )
  ) |>
  select(-prez_dem, -prez_gop, -day)

pols_month
```

    ## # A tibble: 822 × 9
    ##    year month gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president
    ##   <int> <chr>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>    
    ## 1  1947 Jan        23      51     253      23      45     198 dem      
    ## 2  1947 Feb        23      51     253      23      45     198 dem      
    ## 3  1947 Mar        23      51     253      23      45     198 dem      
    ## 4  1947 Apr        23      51     253      23      45     198 dem      
    ## 5  1947 May        23      51     253      23      45     198 dem      
    ## # ℹ 817 more rows

## 1.2

``` r
snp <- 
  read_csv("./fivethirtyeight_datasets/snp.csv", show_col_types = FALSE) |>
  janitor::clean_names() |>
  separate(date, into = c("month", "day", "year"), sep = "/") |>
  mutate(
    year = as.integer(year),
    year = ifelse(year >= 50, 1900 + year, 2000 + year),
    month = as.integer(month),
    day = as.integer(day),
    month = month.abb[month]
  ) |>
  select(year, month, close) |>
  arrange(year, match(month, month.abb))

snp
```

    ## # A tibble: 787 × 3
    ##    year month close
    ##   <dbl> <chr> <dbl>
    ## 1  1950 Jan    17.0
    ## 2  1950 Feb    17.2
    ## 3  1950 Mar    17.3
    ## 4  1950 Apr    18.0
    ## 5  1950 May    18.8
    ## # ℹ 782 more rows

## 1.3

``` r
unemployment_tidy <- 
  read_csv("./fivethirtyeight_datasets/unemployment.csv", show_col_types = FALSE) |>
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemployment_rate"
  ) |>
  mutate(
    unemployment_rate = as.numeric(unemployment_rate)
  ) |>
  rename(year = Year)

unemployment_tidy
```

    ## # A tibble: 816 × 3
    ##    year month unemployment_rate
    ##   <dbl> <chr>             <dbl>
    ## 1  1948 Jan                 3.4
    ## 2  1948 Feb                 3.8
    ## 3  1948 Mar                 4  
    ## 4  1948 Apr                 3.9
    ## 5  1948 May                 3.5
    ## # ℹ 811 more rows

## 1.4

``` r
d1 <- pols_month |>
  left_join(snp, by = c("year", "month")) |>
  left_join(unemployment_tidy, by = c("year", "month")) |>
  arrange(year, match(month, month.abb))

d1
```

    ## # A tibble: 822 × 11
    ##    year month gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president close
    ##   <dbl> <chr>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>     <dbl>
    ## 1  1947 Jan        23      51     253      23      45     198 dem          NA
    ## 2  1947 Feb        23      51     253      23      45     198 dem          NA
    ## 3  1947 Mar        23      51     253      23      45     198 dem          NA
    ## 4  1947 Apr        23      51     253      23      45     198 dem          NA
    ## 5  1947 May        23      51     253      23      45     198 dem          NA
    ## # ℹ 817 more rows
    ## # ℹ 1 more variable: unemployment_rate <dbl>

``` r
# Create date variable version
d2 <- pols_month |>
  left_join(snp, by = c("year", "month")) |>
  left_join(unemployment_tidy, by = c("year", "month")) |>
  mutate(date = str_c(year, "-", sprintf("%02d", match(month, month.abb)))) |>
  relocate(date) |>
  select(-year, -month) |>
  arrange(date)

d2
```

    ## # A tibble: 822 × 10
    ##   date    gov_gop sen_gop rep_gop gov_dem sen_dem rep_dem president close
    ##   <chr>     <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl> <chr>     <dbl>
    ## 1 1947-01      23      51     253      23      45     198 dem          NA
    ## 2 1947-02      23      51     253      23      45     198 dem          NA
    ## 3 1947-03      23      51     253      23      45     198 dem          NA
    ## 4 1947-04      23      51     253      23      45     198 dem          NA
    ## 5 1947-05      23      51     253      23      45     198 dem          NA
    ## # ℹ 817 more rows
    ## # ℹ 1 more variable: unemployment_rate <dbl>

The integrated dataset brings together information from three distinct
sources covering political affiliations and economic metrics. Following
individual data cleaning procedures, the pols-month data comprises 822
entries with 9 variables that document the counts of Democratic and
Republican politicians at the federal level, capturing presidential
party affiliations along with tallies of governors, senators, and
representatives. The snp dataset includes 787 records with 3 variables
that track the performance of the Standard & Poor’s stock market index,
providing monthly closing values with corresponding year and month
identifiers. The unemployment component contains 816 observations with 3
variables measuring monthly unemployment percentages across different
calendar years. The merged dataset maintains 822 monthly observations
covering the period from 1947 through 2015 and incorporates 11
variables. Principal variables encompass temporal markers (year and
month), political party distribution metrics (gov_gop, sen_gop, rep_gop,
gov_dem, sen_dem, rep_dem), presidential party affiliation, S&P index
closing figures, and unemployment rates. It should be noted that
although the political data spans the entire 1947-2015 timeframe, the
economic variables show gaps in the earlier years, with S&P records
commencing in 1950 and unemployment data starting in 1948.

# Problem 2 — Trash Wheel

``` r
#Read and clean the Mr. Trash Wheel sheet
mr_tidy <- read_excel("./trash_wheel.xlsx", 
                      sheet = "Mr. Trash Wheel", 
                      skip = 1,
                      na = c(".", "NA", "")) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(
    sports_balls = as.integer(round(sports_balls)),
    year = as.integer(year),
    trash_wheel = "Mr. Trash Wheel"
  )
```

    ## New names:
    ## • `` -> `...15`
    ## • `` -> `...16`

``` r
mr_tidy
```

    ## # A tibble: 707 × 17
    ##   dumpster month  year date                weight_tons volume_cubic_yards
    ##      <dbl> <chr> <int> <dttm>                    <dbl>              <dbl>
    ## 1        1 May    2014 2014-05-16 00:00:00        4.31                 18
    ## 2        2 May    2014 2014-05-16 00:00:00        2.74                 13
    ## 3        3 May    2014 2014-05-16 00:00:00        3.45                 15
    ## 4        4 May    2014 2014-05-17 00:00:00        3.1                  15
    ## 5        5 May    2014 2014-05-17 00:00:00        4.06                 18
    ## # ℹ 702 more rows
    ## # ℹ 11 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, glass_bottles <dbl>, plastic_bags <dbl>,
    ## #   wrappers <dbl>, sports_balls <int>, homes_powered <dbl>, x15 <lgl>,
    ## #   x16 <lgl>, trash_wheel <chr>

``` r
#Read and clean Professor Trash Wheel data
professor_tidy <- read_excel('./trash_wheel.xlsx',
                             sheet = "Professor Trash Wheel",
                             skip = 1,
                             na = c('.', "NA", '')) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(
    year = as.integer(year),
    trash_wheel = "Professor Trash Wheel"
  )

professor_tidy
```

    ## # A tibble: 132 × 14
    ##   dumpster month     year date                weight_tons volume_cubic_yards
    ##      <dbl> <chr>    <int> <dttm>                    <dbl>              <dbl>
    ## 1        1 January   2017 2017-01-02 00:00:00        1.79                 15
    ## 2        2 January   2017 2017-01-30 00:00:00        1.58                 15
    ## 3        3 February  2017 2017-02-26 00:00:00        2.32                 18
    ## 4        4 February  2017 2017-02-26 00:00:00        3.72                 15
    ## 5        5 February  2017 2017-02-28 00:00:00        1.45                 15
    ## # ℹ 127 more rows
    ## # ℹ 8 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, glass_bottles <dbl>, plastic_bags <dbl>,
    ## #   wrappers <dbl>, homes_powered <dbl>, trash_wheel <chr>

``` r
#Read and clean Gwynnda data
gwynnda_tidy <- read_excel('./trash_wheel.xlsx',
                           sheet = "Gwynns Falls Trash Wheel", 
                           skip = 1,
                           na = c('.', "NA", '')) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(
    year = as.integer(year),
    trash_wheel = "Gwynns Falls Trash Wheel"
  )

gwynnda_tidy
```

    ## # A tibble: 349 × 13
    ##   dumpster month  year date                weight_tons volume_cubic_yards
    ##      <dbl> <chr> <int> <dttm>                    <dbl>              <dbl>
    ## 1        1 July   2021 2021-07-03 00:00:00        0.93                 15
    ## 2        2 July   2021 2021-07-07 00:00:00        2.26                 15
    ## 3        3 July   2021 2021-07-07 00:00:00        1.62                 15
    ## 4        4 July   2021 2021-07-16 00:00:00        1.76                 15
    ## 5        5 July   2021 2021-07-30 00:00:00        1.53                 15
    ## # ℹ 344 more rows
    ## # ℹ 7 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, plastic_bags <dbl>, wrappers <dbl>,
    ## #   homes_powered <dbl>, trash_wheel <chr>

``` r
#combine
combined_trash <- bind_rows(mr_tidy, professor_tidy, gwynnda_tidy) |>
  select(-contains("..."), -starts_with("x")) |>
  arrange(date)

combined_trash
```

    ## # A tibble: 1,188 × 15
    ##   dumpster month  year date                weight_tons volume_cubic_yards
    ##      <dbl> <chr> <int> <dttm>                    <dbl>              <dbl>
    ## 1        1 May    2014 2014-05-16 00:00:00        4.31                 18
    ## 2        2 May    2014 2014-05-16 00:00:00        2.74                 13
    ## 3        3 May    2014 2014-05-16 00:00:00        3.45                 15
    ## 4        4 May    2014 2014-05-17 00:00:00        3.1                  15
    ## 5        5 May    2014 2014-05-17 00:00:00        4.06                 18
    ## # ℹ 1,183 more rows
    ## # ℹ 9 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, glass_bottles <dbl>, plastic_bags <dbl>,
    ## #   wrappers <dbl>, sports_balls <int>, homes_powered <dbl>, trash_wheel <chr>

``` r
# Total weight of trash collected by Professor Trash Wheel
prof_total_weight <- combined_trash |>
  filter(trash_wheel == "Professor Trash Wheel") |>
  summarize(total_weight = sum(weight_tons, na.rm = TRUE)) |>
  pull(total_weight)

# Total number of cigarette butts collected by Gwynnda in June 2022
gwynnda_cigarettes <- combined_trash |>
  filter(trash_wheel == "Gwynns Falls Trash Wheel", 
         year == 2022, 
         month == "June") |>
  summarize(total_cigarettes = sum(cigarette_butts, na.rm = TRUE)) |>
  pull(total_cigarettes)

prof_total_weight
```

    ## [1] 282.26

``` r
gwynnda_cigarettes
```

    ## [1] 18120

The resulting dataset combines trash collection data from three separate
devices operating in Baltimore’s Inner Harbor: Mr. Trash Wheel,
Professor Trash Wheel, and Gwynns Falls Trash Wheel. The resulting
dataset contains 1188 observations tracking waste collection with 15
variables. Key variables include dumpster identification numbers,
collection dates, total weight of trash, the number of some specific
waste categories such as plastic bottles, polystyrene, cigarette butts,
and the trash wheel identifier to track the source device. All the
variables are: dumpster, month, year, date, weight_tons,
volume_cubic_yards, plastic_bottles, polystyrene, cigarette_butts,
glass_bottles, plastic_bags, wrappers, sports_balls, homes_powered,
trash_wheel.

Based on the available data, the total weight of trash collected by
Professor Trash Wheel is 282.26 tons. During June 2022, Gwynns Falls
Trash Wheel collected 18120 cigarette butts.

# Problem 3

``` r
zip_codes_tidy <- read_csv("./zillow_data/Zip Codes.csv", 
                           na = c(".", "NA", "")) |>
  janitor::clean_names() |>
  relocate(zip_code) |>
  arrange(zip_code)
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zip_codes_tidy
```

    ## # A tibble: 322 × 7
    ##   zip_code county   state_fips county_code county_fips file_date neighborhood   
    ##      <dbl> <chr>         <dbl> <chr>             <dbl> <chr>     <chr>          
    ## 1    10001 New York         36 061               36061 7/25/07   Chelsea and Cl…
    ## 2    10002 New York         36 061               36061 7/25/07   Lower East Side
    ## 3    10003 New York         36 061               36061 7/25/07   Lower East Side
    ## 4    10004 New York         36 061               36061 7/25/07   Lower Manhattan
    ## 5    10005 New York         36 061               36061 7/25/07   Lower Manhattan
    ## # ℹ 317 more rows

``` r
#Import and clean ZIP ZORI dataset
zip_zori <- read_csv("./zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv",
                     na = c(".", "NA", "")) |>
  janitor::clean_names()
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zip_zori_tidy <- zip_zori |>
  pivot_longer(
    cols = starts_with('x20'),
    names_to = "date",
    values_to = "zori"
  ) |>
  mutate(
    date = str_remove(date, "^x"),
    date = str_replace_all(date, "_", "-")
  ) |>
  relocate(region_name) |>
  arrange(region_name)

zip_zori_tidy
```

    ## # A tibble: 17,284 × 11
    ##   region_name region_id size_rank region_type state_name state city     metro   
    ##         <dbl>     <dbl>     <dbl> <chr>       <chr>      <chr> <chr>    <chr>   
    ## 1       10001     61615      4444 zip         NY         NY    New York New Yor…
    ## 2       10001     61615      4444 zip         NY         NY    New York New Yor…
    ## 3       10001     61615      4444 zip         NY         NY    New York New Yor…
    ## 4       10001     61615      4444 zip         NY         NY    New York New Yor…
    ## 5       10001     61615      4444 zip         NY         NY    New York New Yor…
    ## # ℹ 17,279 more rows
    ## # ℹ 3 more variables: county_name <chr>, date <chr>, zori <dbl>

``` r
#Merge to create final dataset
resulting_tidy_data <- zip_zori_tidy |>
  left_join(zip_codes_tidy, by = c("region_name" = "zip_code")) |>
  select(
    region_name, region_id, size_rank, region_type,
    state_name, state, city, metro, county,
    date, zori, county_code, county_fips, state_fips, file_date, neighborhood
  )
```

    ## Warning in left_join(zip_zori_tidy, zip_codes_tidy, by = c(region_name = "zip_code")): Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 7541 of `x` matches multiple rows in `y`.
    ## ℹ Row 1 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

``` r
resulting_tidy_data
```

    ## # A tibble: 17,516 × 16
    ##   region_name region_id size_rank region_type state_name state city     metro   
    ##         <dbl>     <dbl>     <dbl> <chr>       <chr>      <chr> <chr>    <chr>   
    ## 1       10001     61615      4444 zip         NY         NY    New York New Yor…
    ## 2       10001     61615      4444 zip         NY         NY    New York New Yor…
    ## 3       10001     61615      4444 zip         NY         NY    New York New Yor…
    ## 4       10001     61615      4444 zip         NY         NY    New York New Yor…
    ## 5       10001     61615      4444 zip         NY         NY    New York New Yor…
    ## # ℹ 17,511 more rows
    ## # ℹ 8 more variables: county <chr>, date <chr>, zori <dbl>, county_code <chr>,
    ## #   county_fips <dbl>, state_fips <dbl>, file_date <chr>, neighborhood <chr>

``` r
#Check for completeness
missing_zips <- zip_codes_tidy |>
  anti_join(zip_zori_tidy, by = c("zip_code" = "region_name")) |>
  select(zip_code, county, neighborhood)

missing_zips
```

    ## # A tibble: 171 × 3
    ##   zip_code county   neighborhood       
    ##      <dbl> <chr>    <chr>              
    ## 1    10008 New York <NA>               
    ## 2    10020 New York Chelsea and Clinton
    ## 3    10041 New York <NA>               
    ## 4    10043 New York <NA>               
    ## 5    10045 New York <NA>               
    ## # ℹ 166 more rows

How many total observations exist? How many unique ZIP codes are
included, and how many unique neighborhoods?

The resulting tidy dataset contains 17516 observations with 16
variables. The dataset spans from 2015-01-31 to 2024-08-31, providing a
comprehensive time series of Zillow rental price. All the variables in
this dataset are: region_name, region_id, size_rank, region_type,
state_name, state, city, metro, county, date, zori, county_code,
county_fips, state_fips, file_date, neighborhood.

Besides, the dataset includes 149 unique ZIP codes and 42 unique
neighborhoods across New York City. The structure also reveals that 5
distinct counties represented in the dataset.

Which ZIP codes appear in the ZIP code dataset but not in the Zillow
Rental Price dataset? Using a few illustrative examples discuss why
these ZIP codes might be excluded from the Zillow dataset.

There are 171 ZIP codes that appear in the ZIP code dataset but not in
the Zillow Rental Price dataset. Examples include 10101, 10102, 10103,
10104, and 10105. The details of these examples are following:

10101, 10102, 10103, 10104, and 10105 are all located in Manhattan,
specifically in areas that appear to be primarily commercial or
institutional districts.

These ZIP codes correspond to the Midtown Manhattan area, which is
dominated by office buildings, commercial establishments, and
institutional facilities rather than residential housing.

These examples from Midtown Manhattan are likely excluded from the
Zillow dataset for several reasons: firstly, these areas have very
limited residential rental inventory due to their commercial nature,
resulting in insufficient rental transaction data to calculate reliable
ZORI values; secondly, the few residential units that do exist in these
areas may be highly specialized (such as corporate housing or luxury
condos) and not representative of the broader rental market; thirdly,
Zillow’s methodology requires a minimum threshold of rental data
availability which these commercial-dominated ZIP codes may not meet.

``` r
covid_rental <- resulting_tidy_data |>
  filter(date == "2020-01-31" | date == "2021-01-31") |>
  select(region_name, county, neighborhood, date, zori) |>
  pivot_wider(
    names_from = date,
    values_from = zori
  ) |>
  mutate(
    price_change = `2021-01-31` - `2020-01-31`,
    price_change_pct = (`2021-01-31` - `2020-01-31`) / `2020-01-31` * 100
  ) |>
  filter(!is.na(price_change)) |>
  arrange(price_change) |>
  head(10) |>
  rename(
    zip_code = region_name,
    borough = county,
    Jan_2020 = `2020-01-31`,
    Jan_2021 = `2021-01-31`
  ) |>
  select(zip_code, borough, neighborhood, Jan_2020, Jan_2021, price_change, price_change_pct)

cat("Top 10 ZIP codes with largest rental price drops from January 2020 to January 2021:\n")
```

    ## Top 10 ZIP codes with largest rental price drops from January 2020 to January 2021:

``` r
covid_rental
```

    ## # A tibble: 10 × 7
    ##    zip_code borough neighborhood Jan_2020 Jan_2021 price_change price_change_pct
    ##       <dbl> <chr>   <chr>           <dbl>    <dbl>        <dbl>            <dbl>
    ##  1    10007 New Yo… Lower Manha…    6334.    5422.        -913.            -14.4
    ##  2    10069 New Yo… <NA>            4623.    3875.        -748.            -16.2
    ##  3    10009 New Yo… Lower East …    3406.    2692.        -714.            -21.0
    ##  4    10016 New Yo… Gramercy Pa…    3731.    3019.        -712.            -19.1
    ##  5    10001 New Yo… Chelsea and…    4108.    3398.        -710.            -17.3
    ##  6    10002 New Yo… Lower East …    3645.    2935.        -710.            -19.5
    ##  7    10004 New Yo… Lower Manha…    3150.    2444.        -706.            -22.4
    ##  8    10038 New Yo… Lower Manha…    3573.    2876.        -698.            -19.5
    ##  9    10012 New Yo… Greenwich V…    3629.    2942.        -686.            -18.9
    ## 10    10010 New Yo… Gramercy Pa…    3697.    3012.        -685.            -18.5

The analysis reveals a pronounced pattern of rental price decreases
concentrated primarily in Manhattan ZIP codes during the pandemic
period. All ten areas with the most significant declines saw reductions
between -22.4% and -14.4%, with the most substantial drop of -14.4%
observed in ZIP code 10007. The geographic distribution of these
declines highlights how Manhattan’s core business and tourist districts
were disproportionately affected. This trend likely reflects the
substantial outmigration from dense urban centers as remote work
arrangements became widespread, coupled with the sharp reduction in
tourism and in-person office work that traditionally supported the
rental market in these high-density neighborhoods.
